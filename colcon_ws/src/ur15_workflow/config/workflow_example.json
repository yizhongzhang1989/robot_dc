{
  "context": {
    "robot_ip": "192.168.1.15",
    "robot_port": 30002,
    "camera_topic": "/ur15_camera/image_raw",
    "camera_params_path": "../temp/ur15_cam_calibration_result/ur15_camera_parameters",
    "positioning_service_url": "http://localhost:8004"
  },
  "workflow": [
    {
      "id": "init_robot",
      "type": "robot_move",
      "description": "Move robot to home position",
      "robot_pose": [
        0,
        -1.57,
        1.57,
        -1.57,
        -1.57,
        0
      ],
      "move_type": "movej",
      "velocity": 0.3,
      "acceleration": 0.3,
      "wait_time": 2.0,
      "stop_on_failure": true
    },
    {
      "id": "move_to_rack_bottom_left",
      "type": "robot_move",
      "description": "Move to rack bottom left corner",
      "robot_pose": "load_from_json:../temp/recorded_GB200_locate_positions.json:rack_bottom_left",
      "move_type": "movej",
      "velocity": 0.5,
      "acceleration": 0.5,
      "wait_time": 1.0,
      "stop_on_failure": true
    },
    {
      "id": "capture_rack_bottom_left",
      "type": "movement_pattern",
      "description": "Capture images at rack bottom left with 5-point grid",
      "pattern_type": "grid_5point",
      "pattern_params": {
        "offset_distance": 0.01
      },
      "center_pose": "${current_robot_pose}",
      "operation_name": "rack_bottom_left",
      "save_to_session": true,
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "move_to_rack_bottom_left"
        }
      ]
    },
    {
      "id": "move_to_rack_bottom_right",
      "type": "robot_move",
      "description": "Move to rack bottom right corner",
      "robot_pose": "load_from_json:../temp/recorded_GB200_locate_positions.json:rack_bottom_right",
      "move_type": "movej",
      "velocity": 0.5,
      "acceleration": 0.5,
      "wait_time": 1.0,
      "stop_on_failure": true
    },
    {
      "id": "capture_rack_bottom_right",
      "type": "movement_pattern",
      "description": "Capture images at rack bottom right with 5-point grid",
      "pattern_type": "grid_5point",
      "pattern_params": {
        "offset_distance": 0.01
      },
      "center_pose": "${current_robot_pose}",
      "operation_name": "rack_bottom_right",
      "save_to_session": true,
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "move_to_rack_bottom_right"
        }
      ]
    },
    {
      "id": "move_to_rack_top_left",
      "type": "robot_move",
      "description": "Move to rack top left corner",
      "robot_pose": "load_from_json:../temp/recorded_GB200_locate_positions.json:rack_top_left",
      "move_type": "movej",
      "velocity": 0.5,
      "acceleration": 0.5,
      "wait_time": 1.0,
      "stop_on_failure": true
    },
    {
      "id": "capture_rack_top_left",
      "type": "movement_pattern",
      "description": "Capture images at rack top left with 5-point grid",
      "pattern_type": "grid_5point",
      "pattern_params": {
        "offset_distance": 0.01
      },
      "center_pose": "${current_robot_pose}",
      "operation_name": "rack_top_left",
      "save_to_session": true,
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "move_to_rack_top_left"
        }
      ]
    },
    {
      "id": "move_to_rack_top_right",
      "type": "robot_move",
      "description": "Move to rack top right corner",
      "robot_pose": "load_from_json:../temp/recorded_GB200_locate_positions.json:rack_top_right",
      "move_type": "movej",
      "velocity": 0.5,
      "acceleration": 0.5,
      "wait_time": 1.0,
      "stop_on_failure": true
    },
    {
      "id": "capture_rack_top_right",
      "type": "movement_pattern",
      "description": "Capture images at rack top right with 5-point grid",
      "pattern_type": "grid_5point",
      "pattern_params": {
        "offset_distance": 0.01
      },
      "center_pose": "${current_robot_pose}",
      "operation_name": "rack_top_right",
      "save_to_session": true,
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "move_to_rack_top_right"
        }
      ]
    },
    {
      "id": "compute_3d_positioning",
      "type": "positioning",
      "description": "Compute 3D positions using all captured images",
      "template_points": [
        {
          "name": "GB200_Rack_Bottom_Left_Corner",
          "x": 0,
          "y": 0,
          "z": 0.0
        },
        {
          "name": "GB200_Rack_Bottom_Right_Corner",
          "x": 0.55,
          "y": 0,
          "z": 0.0
        },
        {
          "name": "GB200_Rack_Top_Left_Corner",
          "x": 0,
          "y": 0,
          "z": 2.145
        },
        {
          "name": "GB200_Rack_Top_Right_Corner",
          "x": 0.55,
          "y": 0,
          "z": 2.145
        }
      ],
      "timeout": 10000,
      "save_to_status": true,
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "capture_rack_top_right"
        }
      ]
    },
    {
      "id": "build_wobj_frame",
      "type": "coordinate_frame",
      "description": "Build wobj coordinate system from 4 corner points",
      "method": "four_point_orthogonal",
      "save_to_status": true,
      "save_to_file": "../temp/wobj_coordinate_system/wobj_result.json",
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "compute_3d_positioning"
        }
      ]
    },
    {
      "id": "validate_results",
      "type": "validation",
      "description": "Validate positioning and frame building results",
      "validation_types": [
        "reprojection_error",
        "coordinate_frame_orthogonality"
      ],
      "save_visualizations": true,
      "conditions": [
        {
          "type": "previous_success",
          "operation_id": "build_wobj_frame"
        }
      ]
    },
    {
      "id": "return_home",
      "type": "robot_move",
      "description": "Return robot to home position",
      "robot_pose": [
        0,
        -1.57,
        1.57,
        -1.57,
        -1.57,
        0
      ],
      "move_type": "movej",
      "velocity": 0.3,
      "acceleration": 0.3,
      "wait_time": 1.0,
      "stop_on_failure": false
    }
  ]
}